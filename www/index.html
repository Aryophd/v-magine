<html>
    <head>
        <script src="./scripts/jquery-1.11.1.min.js"></script>
        <script src="./scripts/term.js"></script>
        <link rel="stylesheet" type="text/css" href="main.css">

        <script language="javascript" type="text/javascript">

            function handleError(msg) {
                alert(msg);
            }

            function statusChanged(msg) {
                $('#status').text(msg);
            }

            function gotStdOutData(data){
                //console.log(data);
                term.write(data.replace('\n', '\r\n'));
            }

            function gotStdErrData(data){
                //console.log("err: " + data);
                term.write(data.replace('\n', '\r\n'));
            }

            function startInstall() {
                console.log("startInstall!");
                try {
                    term.reset();
                    controller.install();
                }
                catch(ex)
                {
                    handleError(ex);
                }
            }

            var term;

            function setupTerm() {
                term_cols = 136
                term_rows = 36

                term = new Terminal({
                    cols: term_cols,
                    rows: term_rows,
                    useStyle: true,
                    screenKeys: true,
                    cursorBlink: false
                });

                term.on('data', function(data) {
                    // TODO: write back
                });

                controller.set_term_info('vt100', term_cols, term_rows)

                term.open($('#term')[0]);
                //term.write('\x1b[31mWelcome to term.js!\x1b[m\r\n');
            }

            function ApplicationIsReady() {
                try {
                    console.log("ApplicationIsReady!");

                    setupTerm();

                    controller.on_status_changed_event.connect(statusChanged);
                    controller.on_stdout_data_event.connect(gotStdOutData);
                    controller.on_stderr_data_event.connect(gotStdErrData);
                    controller.on_error_event.connect(handleError);
                 }
                catch(ex)
                {
                    handleError(msg);
                }
            }

        </script>
    </head>
    <body>
        <div id="outer">
            <div id="status"></div>
            <div id="term"></div>
            <button onclick=startInstall()>Get OpenStack!</button>
        </div>
    </body>
</html>